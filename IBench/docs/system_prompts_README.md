# 系统提示词文档说明

## 概述

`system_prompts_collection.md` 文档包含了从新数据源提取的前20个唯一的系统提示词。

## 文档信息

- **数据来源**: `C:\Users\wudw\Documents\company\tmp\normal_dataset.json`
- **提取日期**: 2026年2月5日
- **提取数量**: 前20个唯一系统提示词
- **总数据量**: 25,374个条目
- **文档大小**: 59.03 KB
- **字段名称**: `system`

## 新数据源特点

### 1. 结构化设计
新数据源的提示词采用了更加结构化的设计：

#### **组件化结构**
- **角色设定**: 明确定义角色身份
- **语言风格与去AI味规范**: 硬性约束
- **原子化槽位表 (Slot Schema)**: 明确的信息收集字段
- **硬性执行指标 (Hard Rules)**: 强制执行规则
- **获客与拒绝策略**: 转化策略
- **输出格式规范**: JSON对象格式

#### **槽位表示例**
```
- age: (数字，必填)
- gender: (男/女，必填)
- phone: (手机号，互斥必填项)
- wechat: (微信号，互斥必填项)
- symptom: (主诉症状，必填)
```

#### **硬性执行指标**
- [身份锚定]: 首轮简单礼貌开场
- [留联触发]: 第5轮强制启动留联
- [询问密度]: 每轮最多1个问题
- [终止红线]: 获取联系方式前不结束对话

### 2. 与旧数据源对比

| 特性 | 旧数据源 | 新数据源 |
|------|---------|---------|
| 字段名 | `system_prompt` | `system` |
| 格式 | 自然语言描述 | 结构化规范 |
| 约束说明 | 段落式描述 | 分类明确（Hard Constraints/Hard Rules） |
| 信息收集 | 流程描述 | 槽位表 (Slot Schema) |
| 输出格式 | 文本回复 | JSON对象（thought/slot_values/response） |
| 强制执行 | 思维链指令 | Override逻辑 |

### 3. 共同特征

#### **对话流程**
- ✅ 首轮开场规则
- ✅ 信息获取顺序
- ✅ 轮次约束
- ✅ 留联时机（第5-6轮）

#### **禁忌约束**
- ✅ 禁用感谢用语
- ✅ 禁用解释性语句
- ✅ 禁止列表式回复
- ✅ 禁止复述用户信息

#### **获客策略**
- ✅ 留联顺序（先电话/先微信）
- ✅ 留联理由（详细讲解、免费指导）
- ✅ 降级策略
- ✅ 持续尝试直到成功

## 使用场景

### 1. 黄金历史评估
- 生成符合结构化规范的测试用例
- 验证槽位表覆盖情况
- 测试硬性执行指标

### 2. 规则映射与验证
- 验证现有评估规则的覆盖率
- 识别新规则需求
- 优化规则定义

### 3. 模型训练与评估
- 作为训练数据参考标准
- 评估模型输出格式（JSON对象）
- 测试槽位提取准确性

## 提示词覆盖规则分析

### 单轮规则对应
- ✅ 禁用感谢用语 → "禁止使用'谢谢'等感谢用语"
- ✅ 禁用解释性语句 → "禁止使用'这有助于...'等解释性语句"
- ✅ 禁用列表式回复 → "拒绝列表：严禁使用1.2.3.列表式回复"

### 阶段规则对应
- ✅ 询问咨询对象 → "relationship: 咨询者与患者关系（必填）"
- ✅ 询问性别 → "gender: (男/女，必填)"
- ✅ 留联触发 → "第5轮强制启动首次留联尝试"
- ✅ 终止红线 → "严禁在成功获取电话或微信号之前主动结束对话"

### 新增规则建议

基于新数据源的提示词，可考虑添加以下评估规则：

1. **JSON输出格式验证**
   - 验证是否包含 `thought`, `slot_values`, `response` 字段

2. **槽位覆盖验证**
   - 验证必填槽位是否都有值（age, gender, symptom, relationship）
   - 验证互斥槽位是否只有一个有值（phone/wechat）

3. **询问密度验证**
   - 验证每轮是否只问了1个问题

4. **Override指令验证**
   - 验证是否正确处理 `<action>` 标签

## 统计数据

```
总数据量: 25,374个条目
唯一提示词: 20个（前20个）
覆盖率: 0.08%
平均每个提示词对应: ~1,269个条目
```

## 与评估规则的对应关系

### 已覆盖规则（16条）
- ✅ 5个单轮规则全部覆盖
- ✅ 11个阶段规则全部覆盖

### 新增规则类型（基于新数据源）
- 槽位提取验证
- JSON输出格式验证
- 询问密度验证
- 强制执行逻辑验证

## 文件位置

完整文档: `docs/system_prompts_collection.md`
提取脚本: `scripts/extract_system_prompts_new.py`
